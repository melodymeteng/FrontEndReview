### TCP

1.**TCP的特性**
（1）面向连接的，可靠的传输
（2）一对一全双工通信，不适用广播和多播
（3）使用校验和、重传等保证数据的可靠性
（4）对数据进行分节排序，保证报文顺序以及不重复

2.**TCP建立连接，三次握手**
（1）客户端发起请求，报文SYN=1，代表我要开始连接了
（2）服务端收到请求，返回客户端SYN=1,ACK=1，ACK=1表示我确认同意连接
（3）客户端收到请求，返回客户端ACK=1，表示我也同意连接，咱俩连起来了。至此客户端和服务端都进入ESTABLISHED。

3.**TCP断开连接，四次挥手**
（1）客户端发起请求，报文FIN=1，代表我要断开连接，客户端进入FIN_WAIT_1状态
（2）服务端收到请求，返回客户端报文ACK=1，代表我确认同意断开连接，服务端进入CLOSE_WAIT状态，客户端进入FIN_WAIT_2状态，此时客户端到服务端的连接断开了
（3）服务端再次向客户端发送报文FIN=1，表示我这边没有数据要发送了，服务端进入LAST_ACK状态
（4）客户端收到FIN=1后，向服务端发送报文ACK=1，表示客户端也确认断开，客户端进入TIME_WAIT状态，服务端在收到ACK=1时，进入CLOSE状态，此时服务端到客户端的连接断开，客户端也到CLOSE状态。

4.**TCP是怎么保证数据传输的可靠性**
（1）**检验和**，TCP和UDP在计算式都会加上12byte的伪首部，检验TCP首部和数据部分，UDP是可选要不要加12byte的，TCP是必须有的。
（2）**ACK应答机制**，发送过来的消息只有收到对方确认后才有效，只有在首部的ACK=1时才有效
（3）**可靠的连接机制**，三次握手，四次挥手
（4）**滑动窗口**，发送方和接收方都有滑动窗口，在窗口左侧的报文被发送确认后，窗口会向右侧滑动。当报文太多处理不过来时，窗口也可以从右往左向右侧滑动，缩小窗口
（5）**快重传和超时重传**，保证了数据能够不丢失的传输数据。快重传是发送方连续收到3个接收方发送的同一个ack时，此时快速重传ack序号以及其之后的所有数据报。超时重传是：当发送方发送了数据给接收方，当时超过了约定的时间（RTO）也没有接收到确认消息，此时重传此报文
（6）**拥塞控制**：：拥塞控制使得宏观网络中的资源能够合理的应用。实现的算法有四个，慢开始，拥塞避免，快速回复，和快速重传。慢开始指一开始发送报文时，不清楚网络中的情况，试探性的发送1cwnd的数据量，如果没有到门限值，则以指数形式增长，一直到门限值；当到达门限值时，此时采用拥塞避免算法，此时并没有发生网络拥塞，所以可以继续增加数据的发送量，但是不能是指数性增长了，而是+1增长，一直到发生网络拥塞为止；当发生网络拥塞时，此时采用快速回复算法，使得发送的数据量cwnd坠降到此次的门限值。在使用拥塞避免算法，发生网络拥塞再次快速回复，循环往复
（7）**给数据分节排序**，这样接受的数据乱序了可以立马知道，也可以去除重复的报文

5.**TCP和UDP的区别**
（1）TCP是面向连接的，UDP是无连接的
（2）TCP是一对一全双工通信，UDP是n对m的多播
（3）TCP有粘包现象，UDP没有
（4）TCP数据传输是可靠的，因为有丢包重传机制，UDP数据传输不可靠，丢包后数据就丢失了
（5）TCP数据传输是有序的，UDP是无序的
（6）TCP有拥塞控制，UDP没有

6.**TCP的粘包，以及粘包的处理方法**
（1）TCP默认会采用延迟传送算法，如果短时间有多个数据发送，那么会缓冲到一起一次性发送。而这样也可能导致粘包，例如：
    1）发送者接连发送了两个包send1和send2，接收者先接收到了send1和send2的一部分，然后再接收到了send2剩余部分
    2）发送者接连发送了两个包send1和send2，接收者一次性收到了这俩个包
    3）发送者接连发送了两个包send1和send2，接收者先接收到了send2的一部分，然后再接收到了send1和send2的剩余部分
（2）可以通过增加间隔等待时间、关闭延迟传送算法、拆包/封包来解决
    1）增加间隔等到时间，在每个包发送后等待一段时间再发送下一个包
    2）关闭延迟传送算法，node里可以通过socket.setNoDelay()关闭
    3）发包前对包的前后加一些特征数据（封包），接收到后再根据特征对包进行拆分（拆包）